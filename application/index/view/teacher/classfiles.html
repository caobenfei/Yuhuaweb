<!DOCTYPE html>
<!-- saved from url=(0053)http://www.hnhgjx.cn:1700/course_set/152/manage/files -->
<html lang="zh_CN"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <title>课程文件 - 课程管理 - 豫化在线课堂 - 豫化在线课堂 - Powered By EduSoho</title>
 <!--  <meta name="keywords" content="
EduSoho网络课堂,在线教育,在线教学,开源教学软件">
  <meta name="description" content="EduSoho是面向个人、学校、培训机构及企业用户的友好、开源、高性价比的在线教育建站系统。Edusoho提供在线教学、网校管理、云视频点播、直播、移APP等功能，为使教育机构能够以最低成本开展在线教学活动，EduSoho也提供云服务器，云视频、云直播和移动APP定制服务，并配备相应的技术支持服务，让客户搭建自有品牌网校和搭积木一样简单。EduSoho产品及服务大大降低了传统教育培训机构进入在线教育行业的门槛。与其他在线教育产品相比，EduSoho具有完整，高自由度，高性价比的产品体验，使用其搭建在线教学网站是快速进入在线教育的最佳选择方案。EduSoho开源并免费提供给非商业用途用户使用，用户可在3分钟内搭建功能完备的在线教育网站。">
  <meta content="eHLZ7lY1buIBs0MLBtjF22OOnONvwFtpEqPBem-URxE" name="csrf-token">
  <meta content="1" name="is-login">
  <meta content="0" name="is-open"> -->


  <!--[if lt IE 9]>
  <script src="/static-dist/libs/html5shiv.js?version=8.1.5"></script>
  <script src="/static-dist/es5-shim/es5-shim.js?version=8.1.5"></script>
  <script src="/static-dist/es5-shim/es5-sham.js?version=8.1.5"></script>
  <![endif]-->


<link href="__CSS__vendor.css" rel="stylesheet">
<link href="__CSS__app-bootstrap.css" rel="stylesheet">
<link href="__CSS__main.css" rel="stylesheet">
    <link rel="stylesheet" href="__CSS__student/student-index.css">
<link rel="stylesheet" type="text/css" href="__TEACHERUPLOAD__webuploader.css">
<style type="text/css">
body,ol,ul,h1,h2,h3,h4,h5,h6,p,th,td,dl,dd,form,fieldset,legend,input,textarea,select{margin:0;padding:0}
a{color:#2d374b;text-decoration:none}
a:hover{color:#cd0200;text-decoration:underline}
em{font-style:normal}
li{list-style:none}
img{border:0;vertical-align:middle}
table{border-collapse:collapse;border-spacing:0}
p{word-wrap:break-word}
 </style>
</head>
<body class="es-main-default es-nav-default ">

<!--[if lt IE 9]>
<script src="/static-dist/libs/fix-ie.js?version=8.1.5"></script>
<style>
  .lt-ie9 {
    overflow: hidden;
  }
  .ie-mask {
    z-index: 999999;
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    filter: alpha(opacity=50);
    opacity: 0.5;
    background: #000;
  }
  .ie-alert-wrap {
    position: absolute;
    z-index: 1000000;
    margin: -200px auto 0;
    top: 50%;
    left: 0;
    right: 0;
    text-align: center;
  }
  .ie-alert {
    width: 514px;
    height: 397px;
    margin: 0 auto;
  }
  .ie-alert__chrome,
  .ie-alert__firefox {
    position: absolute;
    z-index: 1000001;
    display: block;
    bottom: 48px;
    width: 60px;
    height: 80px;
  }
  .ie-alert__chrome {
    left: 50%;
    margin-left: -80px;
  }
  .ie-alert__firefox {
    right: 50%;
    margin-right: -80px;
  }
</style>
<div class="ie-mask"></div>
<div class="ie-alert-wrap">
  <div class="ie-alert" style="background:url('/static-dist/app/img/browser/browser_update.png?version=8.1.5')">
    <a href="http://www.baidu.com/s?wd=%E8%B0%B7%E6%AD%8C%E6%B5%8F%E8%A7%88%E5%99%A8" target="_blank" class="ie-alert__chrome"></a>
    <a href="http://firefox.com.cn/download/" target="_blank" class="ie-alert__firefox"></a>
  </div>
</div>

<![endif]-->

  <div class="es-wrap">

      {include file="Public:header" /}
          
      <div id="content-container" class="container">
              

<div class="es-section course-manage-header clearfix">
    <a href="http://www.hnhgjx.cn:1700/course/154">
      <img class="picture" src="./teacher_classfiles_files/courseSet.png"> <!-- courseSet.largePicture -->
    </a>
  <h1 class="title">
        <a class="link-dark" href="http://www.hnhgjx.cn:1700/course/154">11111</a>
          <span class="label label-warning ">未发布</span>
      </h1>

  <div class="teachers">
          教师：
                      <a href="http://www.hnhgjx.cn:1700/user/1">admin</a>
            </div>

  <div class="toolbar hidden-xs">
    
        
          <!--<div class="btn-group">-->
        <!--<a class="btn btn-default btn-sm" target="_blank" href="http://www.hnhgjx.cn:1700/course/154?previewAs=guest">预览</a>-->
      <!--</div>-->
      <!--<div class="btn-group">-->
        <!--<button class="btn btn-success btn-sm course-publish-btn" data-url="/course_set/152/manage/publish">发布课程</button>-->
      <!--</div>-->
      </div>
</div>

        <div class="intro-fixed-group js-intro-btn-group hidden">
    <a type="button" class="intro-btn" href="http://www.qiqiuyu.com/" target="_blank">
    编辑帮助
    </a>
  </div>
  <div class="row">
    <div class="col-md-3">
        {include file="../application/index/view/teacher/public/coursenav.html" /}
    </div>
    <div class="col-md-9">
      
  <style type="text/css">
  .tooltip-inner{
  max-width: 600px;
  }
  </style>
          <div class="panel panel-default" role="courseset-manage-file">
    <div class="panel-heading">
      <a class="btn btn-info btn-sm pull-right" data-toggle="modal" data-target="#modal">
        <i class="glyphicon glyphicon-cloud-upload"></i>添加课程文件
      </a>
      课程文件
    </div>

    <div class="panel-body" id="file-manage-panel" data-file-status-url="/course_set/manage/file/status">
      <table class="table table-striped table-hover" id="course-lesson-table">
        <thead>
          <tr>
            <!--<th width="5%"><input type="checkbox" data-role="batch-select"></th>-->
            <th width="30%">文件名</th>
            <th>类型</th>
            <th>大小</th>
            <th>使用</th>
            <th>最后更新</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
        {empty name="file"}
        <tr class="empty"><td colspan="20">无文件记录</td></tr>
        {else /}
        {volist name="file" id="file" key="k"}
        <tr id="upload-file-tr-1227" data-role="item" data-converthash="ch-coursematerial/126/2018104105227-lqp1g2.xls">
            <!--<td><input value="1227" type="checkbox" data-role="batch-item"></td>-->
            <td>
                <a class="link-dark" href="http://www.hnhgjx.cn:1700/course_set/126/manage/file/1227" target="_blank" rel="tooltip" title="" data-original-title="{$file.filename}">{$file.filename}</a><br>
            </td>
            <td>文档</td>
            <td>{$file.filesize|attrFilesize}</td>
            <td>
                <span class="label label-default tip" data-original-title="" title="">未使用</span>
            </td>
            <td>
                <span class="text-sm">
                    <a class="link-dark ">上传于</a>
                </span>
                <br>
                <span class="color-gray text-sm">{$file.createTime}</span>
            </td>
            <td>删除</td>
        </tr>
        {/volist}
        {/empty}

        <!--<tr id="upload-file-tr-1226" data-role="item" data-converthash="ch-coursematerial/126/2018104105205-qw7gqw.doc">-->
            <!--<td><input value="1226" type="checkbox" data-role="batch-item"></td>-->
            <!--<td>-->
                <!--<a class="link-dark" href="http://www.hnhgjx.cn:1700/course_set/126/manage/file/1226" target="_blank" rel="tooltip" title="" data-original-title="部署实施规范（暂行）.doc">部署实施规范（暂行）.doc</a><br>-->
            <!--</td>-->
            <!--<td>文档</td>-->
            <!--<td>  15.00 KB</td>-->
            <!--<td>-->
                <!--<span class="label label-default tip" data-original-title="" title="">未使用</span>-->
            <!--</td>-->
            <!--<td>-->
                <!--<span class="text-sm">    -->
                    <!--<a class="link-dark " href="http://www.hnhgjx.cn:1700/user/1">admin</a>-->
                <!--</span>-->
                <!--<br>-->
                <!--<span class="color-gray text-sm">2018-1-04 10:52</span>-->
            <!--</td>-->
            <!--<td></td>-->
        <!--</tr>-->
        </tbody>

      </table>
        {$page}
      <!--<label class="checkbox-inline mrm mbm"><input type="checkbox" data-role="batch-select"> 全选</label>-->

      <!--<div class="btn-group mbm">-->
                  <!--<button class="btn btn-danger btn-sm" data-role="batch-delete" data-name="文件记录" data-url="/course_set/152/manage/show/delete/materials?type=courseLesson">-->
                <!--<i class="glyphicon glyphicon-trash"></i>-->
        <!--移除</button>-->
      <!--</div>-->

      <nav class="text-center">
          
      </nav>

    </div>
  </div>
    </div>
  </div>
        </div>

          
                                          
<footer class="es-footer">
  <div class="copyright">
    <div class="container">
        Powered by <a href="http://www.hnhgjx.cn/" target="_blank">yuhuazaixian8.0.16</a>
  
      
      
      <div class="mts">
                      </div>
    </div>
  </div>
</footer>    
        
      </div>

        
  
 <div id="login-modal" class="modal"></div>
  <div id="modal" class="modal" style="display:none; padding-right: 17px;">
<div class="modal-dialog  modal-lg">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h4 class="modal-title">上传文件</h4>
    </div>
    <div class="modal-body">
      <div>
                  <div id="uploader">
                      <div>
                        <div id="dndArea" style="border:1px solid #eee;">
                          <ul style="width:100%; height:40px; background:#eee; line-height:40px;">
                    <li style="width:40%; float:left; padding-left:10px;">文件名</li>
                    <li style="width:20%; float:left; padding-left:10px;">大小</li>
                    <li style="width:20%; float:left; padding-left:10px;">状态</li>
                    <li style="width:20%; float:left; padding-left:10px;">操作</li>
                          </ul>
                           <div id="fileList" class="uploader-list"  style="width:100%; height:300px; overflow-y:auto;"></div>
                          <!--存放文件的容器-->
                        </div>
                         
                     </div>
                      <div class="btns">

                        <div id="UploadBtn" class="webuploader-pick"
                              style="float: right; margin-right: 10px; margin-top:10px;">开始上传</div>
                          <div id="picker" class="webuploader-container"
                              style="float: right; margin-right: 10px; margin-top:10px;">
                              <div>
                                  选择文件 <input type="file" name="file"
                                      class="webuploader-element-invisible" multiple="multiple">
                              </div>
                          </div>

                          
                          <!-- <div id="StopBtn" class="webuploader-pick"
                              style="float: left; margin-right: 10px" status="suspend">暂停上传</div> -->
                      </div>
                  </div>
              </div>
   
    </div>
  
</div>
          <div class="modal-footer" style="background:#fff;">    <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
</div>
          </div>
</div>

</div>
  <div id="attachment-modal" class="modal"></div>
  
  
<script>
  if (typeof app === 'undefined') {
      var app = {};
  }
  app.version = '8.1.5';
  app.httpHost = 'http://www.hnhgjx.cn:1700';
  app.basePath = 'http://www.hnhgjx.cn:1700';
  app.theme = 'jianmo';

    
  var CLOUD_FILE_SERVER = ""; 

  app.config = {"api":{"weibo":{"key":""},"qq":{"key":""},"douban":{"key":""},"renren":{"key":""}},"loading_img_path":"\/assets\/img\/default\/loading.gif?version=8.1.5"};

  app.arguments = {};
      
  app.scripts = null;

  app.uploadUrl = '/file/upload';
  app.imgCropUrl = '/file/img/crop';
  app.lessonCopyEnabled = '0';
  app.cloudSdkCdn = '';
  app.lang = 'zh_CN';
</script>

<script src="__JS__bootstrap.js"></script>
<script src="__JS__translator.min.js"></script>
<script src="__JS__js"></script>

      <script src="__JS__vendor.js"></script>
        <script src="__JS__common.js"></script>
        <script src="__JS__main.js"></script>
      
  
 <script src="__JS__jquery.SuperSlide.2.1.1.js"></script>
    <script type="text/javascript" src="__TEACHERUPLOAD__webuploader.js"></script>

<script type="text/javascript">
      

     var uploader    
//在点击弹出模态框的时候再初始化WebUploader，解决点击上传无反应问题  
$("#modal").on("shown.bs.modal",function(){ 
  

            $list = $('#fileList');
            var flie_count = 0;
            uploader = WebUploader.create({
                //设置选完文件后是否自动上传
                auto: false,
                //swf文件路径
                swf: 'static/webuploader/Uploader.swf',
                // 文件接收服务端。
                server: 'http://localhost/api/file/getfile',
                // 选择文件的按钮。可选。
                // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                pick: '#picker',
                dnd: '#dndArea',
                chunked: true, //开启分块上传
                chunkSize: 10 * 1024 * 1024,
                chunkRetry: 3,//网络问题上传失败后重试次数
                threads: 1, //上传并发数
                //fileNumLimit :1,
                fileSizeLimit: 2000 * 1024 * 1024,//最大2GB
                fileSingleSizeLimit: 2000 * 1024 * 1024,
                resize: false//不压缩
                //选择文件类型
                //accept: {
                //    title: 'Video',
                //    extensions: 'mp4,avi',
                //    mimeTypes: 'video/*'
                //}
            });
            // 当有文件被添加进队列的时候
            uploader.on('fileQueued', function (file) {
                $list.append('<ul style="width:100%; height:40px; line-height:40px; border-bottom:1px solid #eee; position:relative;" id="' + file.id + '" class="item">' +
                        '<li style="width:40%; float:left; padding-left:10px; position:relative; z-index:99;" class="info">' + file.name + '</li><li  style="width:20%; float:left; padding-left:10px;position:relative; z-index:99;">'+WebUploader.formatSize(file.size)+'</li><li style="width:20%; float:left; padding-left:10px;position:relative; z-index:99;"><p class="state">等待上传</p></li><li class="rems" style="width:20%; float:left; padding-left:20px;position:relative; z-index:99;"><button type="button" fileId="' + file.id + '" class="btn btn-danger btn-delete"><span class="glyphicon glyphicon-trash"></span></button></li></ul>');
                // console.info("id=file_"+flie_count);
                flie_count++;

                //删除要上传的文件
                //每次添加文件都给btn-delete绑定删除方法
                $(".btn-delete").click(function () {
                    //console.log($(this).attr("fileId"));//拿到文件id
                    uploader.removeFile(uploader.getFile($(this).attr("fileId"), true));
                    $(this).parent().parent().fadeOut();//视觉上消失了
                    $(this).parent().parent().remove();//DOM上删除了
                });
                //uploader.options.formData.guid = WebUploader.guid();//每个文件都附带一个guid，以在服务端确定哪些文件块本来是一个
                //console.info("guid= "+WebUploader.guid());

                //md5计算
                uploader.md5File(file)
                    .progress(function(percentage) {
                        console.log('Percentage:', percentage);
                    })
                    // 完成
                    .then(function (fileMd5) { // 完成
                        var end = +new Date();
                        console.log("before-send-file  preupload: file.size="+file.size+" file.md5="+fileMd5);
                        file.wholeMd5 = fileMd5;//获取到了md5
                        //uploader.options.formData.md5value = file.wholeMd5;//每个文件都附带一个md5，便于实现秒传

                        $('#' + file.id).find('p.state').text('请点击上传');
                        console.info("MD5="+fileMd5);
                    });


            });
            // 文件上传过程中创建进度条实时显示。
            uploader.on('uploadProgress', function (file, percentage) {
                var $li = $('#' + file.id),
                        $percent = $li.find('.progress .progress-bar');
                // 避免重复创建
                if (!$percent.length) {
                    $percent = $('<div class="progress progress-striped active" style="height:40px; width:100% ;position:absolute; z-index:1;" >' +
                            '<div class="progress-bar" role="progressbar" style="height:40px;width: 0%; background:green;">' +
                            '</div>' +
                            '</div>').appendTo($li).find('.progress-bar');
                }
                // $li.find('p.state').text('上传中');
                $percent.css('width', percentage * 100 + '%');
                var num = percentage * 100;
                num = num.toFixed(2);
                $li.find('p.state').text(num + '%');
            });

            //发送前填充数据
            uploader.on( 'uploadBeforeSend', function( block, data ) {
                // block为分块数据。

                // file为分块对应的file对象。
                var file = block.file;
                var fileMd5 = file.wholeMd5;
                // 修改data可以控制发送哪些携带数据。

                console.info("fileName= "+file.name+" fileMd5= "+fileMd5+" fileId= "+file.id);
                console.info("input file= "+ flie_count);
                // 将存在file对象中的md5数据携带发送过去。
                data.md5value = fileMd5;//md5
                data.fileName_ = $("#s_"+file.id).val();
                console.log("fileName_: "+data.fileName_);
                // 删除其他数据
                // delete data.key;
                if(block.chunks>1){ //文件大于chunksize 分片上传
                    data.isChunked = true;
                    console.info("data.isChunked= "+data.isChunked);
                }else{
                    data.isChunked = false;
                    console.info("data.isChunked="+data.isChunked);
                }

            });


            uploader.on('uploadSuccess', function (file,response) {
                $('#' + file.id).find('p.state').text('已上传');
                $('#' + file.id).find(".progress").find(".progress-bar").attr("class", "progress-bar progress-bar-success");
                $('#' + file.id).find(".rems").find('.btn').fadeOut('slow');//上传完后删除"删除"按钮
                $('#StopBtn').fadeOut('slow');


                console.log(response);
                $.post(
                    "{:url('index/teacher/savecoursefile')}",
                    {
                        'filepath':response['data'],
                        'courseid':{$courseid}
                    },
                    function(data){
                        if(data==1){
                            alert("上传成功！");
                            window.location.href = window.location.href;
                        }
                        else{
                            alert("上传失败！");
                            window.location.href = window.location.href;
                        }
                    },
                    "json"
                );
            });
            uploader.on('uploadError', function (file) {
                $('#' + file.id).find('p.state').text('上传出错');
                //上传出错后进度条变红
                $('#' + file.id).find(".progress").find(".progress-bar").attr("class", "progress-bar progress-bar-danger");
                //添加重试按钮
                //为了防止重复添加重试按钮，做一个判断
                //var retrybutton = $('#' + file.id).find(".btn-retry");
                //$('#' + file.id)
                if ($('#' + file.id).find(".btn-retry").length < 1) {
                    var btn = $('<button type="button" fileid="' + file.id + '" class="btn btn-success btn-retry"><span class="glyphicon glyphicon-refresh"></span></button>');
                    $('#' + file.id).find(".info").append(btn);//.find(".btn-danger")
                }
                $(".btn-retry").click(function () {
                    //console.log($(this).attr("fileId"));//拿到文件id
                    uploader.retry(uploader.getFile($(this).attr("fileId")));
                });
            });
            uploader.on('uploadComplete', function (file) {
                //上传完成后回调
                //$('#' + file.id).find('.progress').fadeOut();//上传完删除进度条
                //$('#' + file.id + 'btn').fadeOut('slow')//上传完后删除"删除"按钮
            });
            uploader.on('uploadFinished', function () {
                //上传完后的回调方法
                //alert("所有文件上传完毕");
                //提交表单
            });
            $("#UploadBtn").click(function () {
                uploader.upload();//上传
            });
            $("#StopBtn").click(function () {
                console.log($('#StopBtn').attr("status"));
                var status = $('#StopBtn').attr("status");
                if (status == "suspend") {
                    console.log("当前按钮是暂停，即将变为继续");
                    $("#StopBtn").html("继续上传");
                    $("#StopBtn").attr("status", "continuous");
                    console.log("当前所有文件==="+uploader.getFiles());
                    console.log("=============暂停上传==============");
                    uploader.stop(true);
                    console.log("=============所有当前暂停的文件=============");
                    console.log(uploader.getFiles("interrupt"));
                } else {
                    console.log("当前按钮是继续，即将变为暂停");
                    $("#StopBtn").html("暂停上传");
                    $("#StopBtn").attr("status", "suspend");
                    console.log("===============所有当前暂停的文件==============");
                    console.log(uploader.getFiles("interrupt"));
                    uploader.upload(uploader.getFiles("interrupt"));
                }
            });
            uploader.on('uploadAccept', function (file, response) {
                if (response._raw === '{"error":true}') {
                    return false;
                }
            });
        });


$('#modal').on('hide.bs.modal', function () {
    $("#responeseText").text("");
    uploader.destroy();
    $('.item').remove();
});


    </script>


</body></html>